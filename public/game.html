<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Fighting Game</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />

    <style>
      * {
        box-sizing: border-box;
        font-family: 'Press Start 2P', cursive;
      }

      body, html {
          height: 100%;
          margin: 0;
        }

      body {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0;
        overflow: hidden;
        background: #614f70;
        color: rgb(0, 0, 0);
      }

      canvas {
        display: block;
      }

      #mainMenu {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(to bottom, #111, #222);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 100;
      }

      #mainMenu input {
        font-size: 14px;
        margin: 10px;
        padding: 10px;
        border-radius: 4px;
        border: none;
        text-align: center;
      }

      #mainMenu button {
        margin-top: 20px;
        padding: 12px 24px;
        font-size: 14px;
        border-radius: 6px;
        background: #444;
        color: white;
        border: none;
        cursor: pointer;
      }

      #mainMenu button:hover {
        background: #666;
      }

      #gameContainer {
        display: none;
        position: relative;
        display: inline-block;
      }

      #displayText {
        position: absolute;
        color: white;
        align-items: center;
        justify-content: center;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        display: none;
        font-size: 20px;
      }

      .game-over-content {
      display: flex;
      flex-direction: column;
      align-items: center;   /* âœ… center horizontally */
      justify-content: center; /* âœ… center vertically */
      height: 100%;          /* full height to center properly */
      text-align: center;
      }

      #gameOverScreen {
        position: absolute;
        pointer-events: auto;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background-color: rgba(74, 65, 99, 0.85);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        color: white;
        font-family: 'Press Start 2P', cursive;
        z-index: 999;
        opacity: 0;
        transition: opacity 0.6s ease-in-out;
}

      #gameOverScreen.show {
  opacity: 1;
}

#winnerText {
  font-size: 28px;
  margin-bottom: 30px;
  color: rgb(124, 170, 255);
  text-shadow: 0 0 10px rgb(30, 49, 85), 0 0 20px #000000;
  animation: glow 2s infinite alternate;
  text-align: center;
}

@keyframes glow {
  from { text-shadow: 0 0 10px #917de5; }
  to { text-shadow: 0 0 30px #94bbd3; }
}

.tie {
  color: yellow;
  text-shadow: 0 0 15px #ff693b, 0 0 25px #ffd700;
  animation: tieGlow 2s infinite alternate;
}

@keyframes tieGlow {
  from { text-shadow: 0 0 10px #ffab61; }
  to { text-shadow: 0 0 30px #fff59d; }
}
.game-over-buttons {
  display: flex;
  flex-direction: column;
  gap: 15px;
  align-items: center;   /* âœ… center the buttons */
  justify-content: center;
}

.game-over-buttons button {
  font-size: 14px;
  padding: 12px 18px;  
  min-width: 160px;       
  max-width: 200px;
  background: #444;
  color: white;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s;
}

.game-over-buttons button:hover {
  background: #666;
  transform: scale(1.05);
}

.winner-name {
  color: #e53935; /* bold, warm red */
  text-shadow: 
    0 0 6px #1a1a40,    /* deep bluish base */
    0 0 12px #6b3636,   /* soft cool blue highlight */
    0 0 20px #7cabed;   /* outer light blue glow */
}


.hidden {
  display: none !important;
}
.show {
  display: block !important;
}

.spacer {
  height: 20px; /* or adjust to your preferred spacing */
}

    #loadingScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: url('img/menu.png') center center no-repeat;
      background-size: 80%;
      background-color: #614f70;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
      z-index: 9999;
    }

    #loadingBarContainer {
      width: 80%;
      margin-bottom: 65px; 
      background: #0d366b; 
      border: 2px solid #104180; 
      padding: 4px;
      box-shadow: 0 0 8px #0d366b; 
      border-radius: 12px; 
    }

    #loadingBar {
      width: 0%;
      height: 20px;
      background: #5f90d4; 
      box-shadow: 0 0 8px #104180; 
      transition: width 0.6s;
      border-radius: 8px; 
    }



    #loadingTitle {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'Press Start 2P', cursive;
      font-size: clamp(24px, 6vw, 80px);
      font-weight: bold;
      color: #ffffff;
      line-height: 1.2;
      white-space: pre-line;
      text-align: center;
      letter-spacing: .00001px;
      text-shadow:
        -10px -4px 0 #0d366b,
        -10px  2px 0 #104180,
        -10px  4px 0 #133766,
        0px  4px 0 #0a2c59,
        10px  4px 0 #0a2c59,
        10px  0px 0 #0a2c59,
        10px -4px 0 #0a2c59,
        0px -4px 0 #0a2c59,
        20px 6px 0 #072248;
    }
      /* Pause button (top-left) */
      #pauseControl {
        position: absolute;
        top: 26px;
        left: 8px;
        z-index: 1000;
      }

      /* Settings button (top-right) */
      #settingsControl {
        position: absolute;
        top: 26px;
        right: 8px;
        z-index: 1000;
      }

      #pauseControl button,
      #settingsControl button {
        background: none;
        border: none;
        padding: 0;
        cursor: pointer;
      }

      #pauseControl img,
      #settingsControl img {
        width: 36px;
        height: 36px;
        transition: transform 0.2s;
      }

      #pauseControl img:hover,
      #settingsControl img:hover {
        transform: scale(1.1);
      }


    /* Settings Modal */
    #settingsModal {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-family: 'Press Start 2P', cursive;
      z-index: 2000;
      opacity: 0;
      pointer-events: auto;
      transition: opacity 0.4s ease;
    }

    .settings-content {
      background: rgba(0, 0, 0, 0.7);
      width: 100%;
      height: 100%;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 25px #222, 0 0 50px #000 inset;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 30px;
      min-width: 300px;
    }


    #settingsModal h2 {
      font-size: 28px;
      color: #ffcc00;
      text-shadow: 0 0 15px #ff6600, 0 0 30px #ffcc00;
      animation: pauseGlow 2s infinite alternate;
      margin-bottom: 20px;
    }


    #settingsModal.show {
      opacity: 1;
      pointer-events: auto;
    }

  

     .setting-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: #fff;
    }

    .setting-item input {
      transform: scale(1.3);
      margin-right: 5px;
    }

    .setting-item label {
      cursor: pointer;
    }


    .setting-item .icon {
      width: 28px;
      height: 28px;
    }



    .settings-buttons {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 15px;
}

.settings-buttons button {
  font-size: 14px;
  padding: 12px 20px;
  width: 220px;
  background: #444;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: all 0.2s;
}

.settings-buttons button.icon-only {
  background: #444;         /* dark button background */
  border: 2px solid #666;   /* subtle border */
  padding: 10px;            /* space around icon */
  border-radius: 8px;       /* rounded corners */
  display: inline-flex;     
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
  width: auto;
  min-width: unset;        
  max-width: unset;
}

.settings-buttons button.icon-only:hover {
  background: #666;         /* lighter hover */
  transform: scale(1.1);    /* pop effect */
}

.settings-buttons button.icon-only img {
  width: 28px;   /* slightly smaller icon */
  height: 28px;
}


    #settingsModal button img {
      width: 18px;
      height: 18px;
      filter: drop-shadow(0 0 4px black);
    }

    #settingsModal  button:hover {
      background: #666;
      transform: scale(1.05);
    }
    
    #pauseScreen {
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        border-radius: 12px;
        background: rgba(0, 0, 0, 0.7);
        display: flex;  
        flex-direction: column;
        align-items: center;     
        justify-content: center; 
        text-align: center; 
        color: white;
        font-family: 'Press Start 2P', cursive;
        z-index: 1500;
        opacity: 0;
        pointer-events: auto;
        transition: opacity 0.4s ease;
    }

    #pauseScreen.show {
      opacity: 1;
      pointer-events: auto;
    }

    .pause-content {
      margin-top: 16%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    #pauseTitle {
      font-size: 36px;
      color: #ffcc00;
      text-shadow: 0 0 15px #ff6600, 0 0 30px #ffcc00;
      margin-bottom: 20px;
      animation: pauseGlow 2s infinite alternate;
    }

    @keyframes pauseGlow {
      from { text-shadow: 0 0 10px #ff6600; }
      to { text-shadow: 0 0 30px #ffff99; }
    }

    .pause-buttons {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }

    .pause-buttons button {
    font-size: 14px;
    padding: 12px 18px;  
    width: 220px;    
    min-width: 160px;       
    max-width: 200px;
    background: #444;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;               
    transition: all 0.2s;
  }

  .pause-buttons button img.btn-icon {
    width: 18px;
    height: 18px;
    filter: drop-shadow(0 0 4px black);
  }

  .pause-buttons button:hover {
    background: #666;
    transform: scale(1.05);
  }




    </style>
  </head>

  <body>

    <script type="module" src="js/firebase.js"></script>
    <script type="module" src="./js/sound.js"></script>


      <!-- Loading Screen -->
      <div id="loadingScreen">
        <div id="loadingTitle">FIGHTING<br>GAME</div>
        <div id="loadingBarContainer">
          <div id="loadingBar"></div>
        </div>
      </div>




    <!-- ðŸ•¹ï¸ Game Interface -->
    <div id="gameContainer">
      <!-- Health Bars and Timer -->
      <div
        style="
                position: absolute;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                display: flex;
                width: 90%;
                align-items: center;
                z-index: 500;
        "
      >
        <!-- Player 1 Health -->
        <div
          style="
          position: relative;
          width: 100%;
          display: flex;
          justify-content: flex-end;
          border-top: 4px solid white;
          border-left: 4px solid white;
          border-bottom: 4px solid white;
          "
        >
          <div style="background-color: red; height: 30px; width: 100%"></div>
          <div
            id="playerHealth"
            style="
              position: absolute;
              background: #818cf8;
              top: 0;
              right: 0;
              bottom: 0;
              width: 100%;
            "
          ></div>
        </div>

        <!-- Timer -->
        <div
          id="timer"
          style="
                  background-color: black;
                  width: 100px;
                  height: 50px;
                  flex-shrink: 0;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  color: white;
                  border: 4px solid white;
          "
        >
          60
        </div>

        <!-- Player 2 Health -->
        <div
          style="
            position: relative;
            width: 100%;
            border-top: 4px solid white;
            border-bottom: 4px solid white;
            border-right: 4px solid white;
          "
        >
          <div style="background-color: red; height: 30px"></div>
          <div
            id="enemyHealth"
            style="
              position: absolute;
              background: #818cf8;
              top: 0;
              right: 0;
              bottom: 0;
              left: 0;
            "
          ></div>
        </div>
      </div>
  
      <!-- Pause Button (Top Left) -->
      <div id="pauseControl">
        <button  onclick="togglePause()" id="pauseBtn">
          <img src="./img/icons/Pause.png" alt="Pause" />
        </button>
      </div>

      <!-- Settings Button (Top Right) -->
      <div id="settingsControl">
        <button  onclick="openSettings()">
          <img src="./img/icons/Gear.png" alt="Settings" />
        </button>
      </div>

      <!-- Settings Modal (unchanged) -->
      <div id="settingsModal" class="hidden">
        <div class="settings-content">
          <h2>SETTINGS</h2>

          <div class="setting-item">
            <input type="checkbox" id="soundToggle" checked>
            <img src="./img/icons/Speaker-0.png" alt="Sound" class="icon" />
            <label for="soundToggle">Sound Effects</label>
          </div>

          <div class="setting-item">
            <input type="checkbox" id="musicToggle" unchecked>
            <img src="./img/icons/Music-0.png" alt="Music" class="icon" />
            <label for="musicToggle">Music</label>
          </div>

          <div class="settings-buttons">
          <button class="icon-only"  onclick="closeSettings()">
            <img src="./img/icons/Exit.png" alt="Close" />
          </button>
          </div>
        </div>
      </div>

      <!-- Pause Screen -->
      <div id="pauseScreen" class="hidden">
        <div class="pause-content">
        <h1 id="pauseTitle">PAUSED</h1>
        <div class="pause-buttons">
          <button  onclick="resumeGame()">
            <img src="./img/icons/Play.png" alt="Resume" class="btn-icon" />
            Resume
          </button>
          <button  onclick="goToMenu()">
            <img src="./img/icons/Exit.png" alt="Menu" class="btn-icon" />
            Main Menu
          </button>
          </div>
        </div>
      </div>



      <!-- Game Over Screen -->
        <div id="gameOverScreen" class="game-over-screen hidden" >
         <div class="game-over-content">
          <h1 id="winnerText">Player Wins!</h1>
          <div class="spacer"></div>
          <div class="game-over-buttons">
             <button  onclick="restartGame()">Play Again</button>
             <button  onclick="goToMenu()">Main Menu</button>
             <button  onclick="viewLeaderboard()">Leaderboard</button>
           </div>
          </div>
        </div>



      <!-- Game Canvas -->
      <canvas></canvas>
    </div>




          


    <!-- Scripts -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"
      integrity="sha512-H6cPm97FAsgIKmlBA4s774vqoN24V5gSQL4yBTDOY2su2DeXZVhQPxFK4P6GPdnZqM9fg1G3cMv5wD7e6cFLZQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script type="module" src="./js/sound.js"></script>
    <script src="js/classes.js"></script>
    <script src="js/game.js"></script>
    <script>
const imagesToLoad = [
    './img/loading.png',
    './img/background.png',
    './img/shop.png',
    './img/samuraiMack/Idle.png',
    './img/kenji/Idle.png'
  ];

  // ðŸŽµ Sounds to preload
  const soundsToLoad = {
    button: './sound/button.mp3',
    hover: './sound/hover-button.mp3',
    attack: './sound/sword.mp3',
    hit: './sound/sword-slash.mp3',
    jump: './sound/jumping.mp3',
    done: './sound/fall.mp3',
    win1: './sound/win1.mp3',
    win2: './sound/win2.mp3',
    tie: './sound/tie.mp3',
    run: './sound/run.mp3',
    backgroundMusic: './sound/bgMusic.mp3'
  };

  // âœ… Store preloaded sounds globally
  window.gameSounds = {};

  // âœ… Total assets = images + sounds
  const totalAssets = imagesToLoad.length + Object.keys(soundsToLoad).length;
  let loadedCount = 0;

  function updateLoadingBar() {
    const percent = Math.floor((loadedCount / totalAssets) * 100);
    document.getElementById('loadingBar').style.width = percent + '%';
  }

  function assetLoaded() {
    loadedCount++;
    updateLoadingBar();
    checkAllLoaded();
  }

  // âœ… Preload images
  imagesToLoad.forEach(src => {
    const img = new Image();
    img.src = src;
    img.onload = assetLoaded;
    img.onerror = assetLoaded; // still count if failed
  });

  // âœ… Preload sounds
  Object.entries(soundsToLoad).forEach(([key, src]) => {
    const audio = new Audio();
    audio.src = src;
    audio.preload = "auto";

    audio.oncanplaythrough = assetLoaded;
    audio.onerror = assetLoaded;

    // Special setup
    if (key === "backgroundMusic") {
      audio.loop = true;
      audio.volume = 0.2;
    }
    if (key === "run") {
      audio.loop = true;
      audio.playbackRate = 2.0; // faster footsteps
    }

    window.gameSounds[key] = audio;
  });

  function checkAllLoaded() {
    if (loadedCount >= totalAssets) {
      setTimeout(() => {
        const loadingScreen = document.getElementById('loadingScreen');
        loadingScreen.style.opacity = 0;
        setTimeout(() => {
          loadingScreen.style.display = 'none';
        }, 800);
      }, 500);
    }
  }

  // Unlock sounds on first user interaction
  function unlockAudio() {
    for (const key in window.gameSounds) {
      window.gameSounds[key].play().then(() => {
        window.gameSounds[key].pause();
        window.gameSounds[key].currentTime = 0;
      }).catch(() => {});
    }
    document.removeEventListener("click", unlockAudio);
    document.removeEventListener("keydown", unlockAudio);
  }

  document.addEventListener("click", unlockAudio);
  document.addEventListener("keydown", unlockAudio);
</script>
</body>
</html>